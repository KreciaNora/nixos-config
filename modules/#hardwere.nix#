{ config, pkgs, ... }:

{
  hardware.opengl = {
    enable = true;
    extraPackages = with pkgs; [
      mesa
      libglvnd
      libva
      vaapiIntel
      intel-media-driver
      virglrenderer
    ];
  };

  hardware.opentabletdriver = {
    enable = true;
    daemon.enable = true;
  };

virtualisation.libvirtd = {
  enable = true;
  qemu = {
    package = pkgs.qemu_kvm;
    swtpm.enable = true;
    ovmf.enable = true;
    ovmf.packages = [ pkgs.OVMFFull.fd ];
    runAsRoot = false;
    verbatimConfig = ''
      user = "krecikowa"
      group = "kvm"
    '';
  };
};

virtualisation.spiceUSBRedirection.enable = true;

  programs.virt-manager.enable = true;

  users.users.krecikowa.extraGroups = [ "libvirtd" "kvm" ];
}
